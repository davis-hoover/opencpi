\iffalse
This file is protected by Copyright. Please refer to the COPYRIGHT file
distributed with this source distribution.

This file is part of OpenCPI <http://www.opencpi.org>

OpenCPI is free software: you can redistribute it and/or modify it under the
terms of the GNU Lesser General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

OpenCPI is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU Lesser General Public License for more details.

You should have received a copy of the GNU Lesser General Public License along
with this program. If not, see <http://www.gnu.org/licenses/>.
\fi
%----------------------------------------------------------------------------------------
% Update the docTitle and docVersion per document
%----------------------------------------------------------------------------------------
\def\docTitle{Release Notes}
\def\docVersion{1.5.0}
%----------------------------------------------------------------------------------------
\def\snippetpath{snippets}
\input{\snippetpath/includes}
\input{LaTeX_Header}
\usepackage{multicol}
\setlength{\parindent}{0pt} % Don't indent all paragraphs
\newcommand{\forceindent}{\leavevmode{\parindent=1em\indent}}
\newcommand{\ocpidev}{\code{ocpidev} }
% \newcommand{\bugref}[1]{\hyperref[bug:#1]{AV-#1}: \nameref*{bug:#1}}
\newcommand{\bugref}[1]{\nameref*{bug:#1} (cf.~\ref{bug:#1})}
\date{Version \docVersion} % Force date to be blank and override date with version
\title{\docTitle}
\lhead{\small{\docTitle}}
%----------------------------------------------------------------------------------------
% This command will make diffs look better in the future...
\newcommand{\beginoldnotes}{
% Demote sectional commands from here on out - https://tex.stackexchange.com/a/61803
% This lets us just move the text from above and add a new "origsection" header
\let\origsection\section%
\let\section\subsection%
\let\subsection\subsubsection%
\let\subsubsection\paragraph%
\let\paragraph\subparagraph%
% Make section numbers (Roman)-(Roman).(Arabic) instead of previously defined (Roman)-(Arabic).(Arabic), e.g. old release's II-3 becomes B-II.3 not B-2.3
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\thesection-\Roman{subsection}}
\newpage
\begin{appendices}
The Release Notes from previous releases are included here as reference for still-existing bugs, relevant upgrading notes for users of very old versions, etc.
}
% end of endofnewreleasenotes
%----------------------------------------------------------------------------------------
\begin{document}
\maketitle
\thispagestyle{empty}
\newpage
\pagenumbering{roman}
	\begin{center}
	\textit{\textbf{Revision History}}
		\begin{table}[H]
		\label{table:revisions} % Add "[H]" to force placement of table
			\begin{tabularx}{\textwidth}{|c|X|l|}
			\hline
			\rowcolor{blue}
			\textbf{Revision} & \textbf{Description of Change} & \textbf{Date} \\
		    \hline
			v1.0.1 & Initial creation & 5/2016 \\
			\hline
			v1.1.0 & Updates for 1.1 release & 3/2017 \\
			\hline
			v1.2.0 & Updates for 1.2 release & 8/2017 \\
			\hline
			v1.3.0 & Updates for 1.3 release & 1/2018 \\
			\hline
			v1.3.1 & Updates for 1.3.1 release & 3/2018 \\
			\hline
			v1.4.0 & Updates for 1.4.0 release and moved previous to appendices & 10/2018 \\
			\hline
			v1.5.0 & Updates for 1.5.0 release & 4/2019 \\
			\hline
			\end{tabularx}
		\end{table}
	\end{center}

\newpage

\tableofcontents
% Make section numbers (Roman)-(Arabic).(Arabic) instead of default (Arabic).(Arabic).(Arabic)
\renewcommand\thesection{\Roman{section}}
\renewcommand\thesubsection{\thesection-\arabic{subsection}}
\newpage
\pagenumbering{arabic}
\section*{Overview}
This document contains corrections, changes, and enhancements made to OpenCPI since the previous release. It can never encapsulate \textit{every} change or bug fix, but attempts to assist previous users in getting up and running as swiftly as possible. The \textit{general} format of this document is to answer user questions:
\begin{itemize}
\item Section~I (``Enhancements'') describes ``\textit{What's New?}'' about the current release.
\item Section~II (``Changes and Notes'') is ``\textit{What do I need to be aware of as a \textbf{previous} user of the Framework?}''
\item Section~III (``Major Known Deficiencies'') is for \textit{all} users to answer ``\textit{What bugs should I be aware of?}''
\end{itemize}
The \href{sec:appendices}{appendices} contain the Release Notes from previously released versions of the Framework, roughly following the same format, e.g. \ref{sec:13_enhancements}, being Section~I of the v1.3~Appendix, is the ``Enhancements'' that were added to Release 1.3. \textit{\textbf{It is highly recommended that a new user reviews the appendices as well; not only the main document concerning the latest release.}}

\iffalse
% \origsection{Release XXX}
\section{Enhancements}
\section{Changes and Notes}
\section{Major Known Deficiencies}
\label{sec:XX_bugs}
\subsection{Previously Documented Deficiencies}
\fi

% \origsection{Release 1.5.0}
\section{Enhancements}
\subsection{New Digital Radio Controller Front-End Control Paradigm} (Technology Preview) % AV-3840
\label{sec:15_drc}
This release includes a new OpenCPI Specification File (OCS) which represents the next-generation interface for Radio Frequency (RF) command and control.
This generation improves upon the previous by removing RF vs. Base Band (BB) specificity, allowing for runtime querying of acceptable settings, and supporting multiple RF channels.
Each of these marks an important step towards supporting truly hardware-agnostic RF applications. \\

For more information, consult \path{Dig_Radio_Ctrlr.pdf}.
\subsection{New Time-Based Protocol (``\code{ComplexShortWithMetadata-prot}'') (Technology Preview)} % AV-4804
\label{sec:15_protocol}
One of the major improvements as of 1.5 is to have timestamped data flow from end-to-end using the ``RxApp'' on an E3xx example platform. To achieve this, ``\path{ComplexShortWithMetadata-prot}'' was created. The source to this Protocol (\path{<core>/specs/}) has various comments explaining the new opcodes and arguments as well as example usage.
\subsection{New Time-Based Assets Project (``\code{assets\_ts}'') (Technology Preview)} % AV-5217
\label{sec:15_assets_ts}
The workers required to achieve the previously mentioned goal of timestamped data within ``RxApp'' were derived from those within ``assets'' but are now in their own Project, ``assets\_ts''. This Project mostly exists to work around current limitations within the Framework; whether or not it will continue to exist or if the timestamped versions will return to ``assets'' is still to be determined.

\subsection{New HDL Worker Port Interfaces} % AV-4961
\label{sec:15_smart_wrappers}
A new HDL Worker port interface is now available that considerably reduces code complexity when a Worker ``doesn't care'' about message boundaries, \textit{e.g.} when streaming sequences of data. This interface is currently requested by noting in the OWD that it is ``\texttt{version=2}'' and this interface will become the default in OpenCPI 2.0. Additional information can be found in the \textit{HDL Development Guide}.

\subsubsection*{Some Workers Migrated} % AV-5341
\label{sec:15_v2_workers}
Some of the HDL Workers' source have been updated to use this new ``\texttt{version=2}'' interface to exemplify its usage, while the ``version 1'' (pre-1.5) Worker source code has been migrated to the ``inactive'' Project.
This \textit{should not affect} any applications that previously used these Workers, except the Properties explicitly affecting buffer sizes are now silently ignored.
The following Workers have been upgraded in this way:

\begin{itemize}
\setlength\itemsep{0em} %tighten
\begin{multicols}{3}
\item[] \path{agc_real.hdl}
\item[] \path{cic_dec.hdl}
\item[] \path{cic_int.hdl}
\item[] \path{dc_offset_filter.hdl}
\item[] \path{mfsk_mapper.hdl}
\end{multicols}
\end{itemize}

\subsection{\ocpidev Improvements} % AV-3298 et al
\label{sec:15_ocpidev}
The \ocpidev tool has been significantly improved, including:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item ability to show \code{utilization} of various HDL Workers and Assemblies % AV-3298
\item \code{show component} shows information about Components, including Properties and Ports % AV-5034
\item \code{show worker} information about Workers, including Properties and Ports % AV-4116
\end{itemize}
See \ref{sec:15_ocpidev_changes} for \ocpidev command changes.
\subsection{New ``Zed'' RCC Platform: \code{xilinx13\_4}} % AV-4848
\label{sec:15_new_zed_rcc}
With the introduction of the RCC Platform \path{xilinx13_4} to support the E310 in 1.4, with release 1.5 there are now RPMs available pairing the Zed with both \path{xilinx13_3} and \path{xilinx13_4}. The RPMs follow the naming convention \textit{opencpi-hw-platform-zed-\textless RCCPlatform\textgreater}. See the \textit{Zed Getting Started Guide} for more information.
\subsection{\code{gdb} and \code{rsync} Provided on \code{xilinx13\_3} and \code{xilinx13\_4} RCC Platforms} % AV-5094
Both of these tools are very helpful with development and an ARM-compiled version is now provided in the SD card images provided by OpenCPI. Out of the box, \path{rsync} must be run \textit{from the radio} targeting the development host; more information is available in the applicable \textit{Getting Started Guides}.
\section{Changes and Notes}
\subsection{Deprecation of the ``Readable'' Attribute}
\label{sec:15_readable}
The ``\code{readable}'' Property Accessibility Attribute has been deprecated and replaced with ``\code{readback}.'' \textit{However}, its use case is very rare and specific; by default all Properties are ``readable'' in the usual context of the term.
Additional information can be found in the \textit{Component Development Guide}.

\subsection{Deprecation of Zipper RF Interface Board}
\label{sec:15_zipper} % AV-5257
The \href{https://wiki.myriadrf.org/Zipper_Interface_Board}{Myriad RF Zipper Interface Board} has been unavailable for purchase for a considerable time. While OpenCPI still \textit{theoretically} supports it, limited available quantities have resulted in its removal from the list of officially supported (and therefore tested) platforms. Support infrastructure has been moved to the ``\texttt{inactive}'' project.
\subsection{E3xx PPS Discipline}
\label{sec:15_e3xx_gps} % AV-4994
The ``e3xx'' Platform Worker timebase interface's PPS disciplining was previously limited to only the E310/E312's ``SYNC'' SMB connector (GPS PPS disciplining was not possible). The source selection is now exposed as a parameter on the Platform Worker.
\subsection{``\code{new\_project\_source}'' script removed} % AV-4482
\label{sec:15_new_project_source}
The utility script noted in \ref{sec:13_restructure} has been replaced by the more versatile ``\path{ocpi-copy-projects}'' script. This new utility is in the user's path and has a ``\texttt{--help}'' option.
\subsection{RCC Worker Parameter Macros Stricter} % AV-5105
If an RCC Worker had been using the undocumented / internal ``macro form'' of a parameter, \textit{e.g.} ``\path{PARAM_biasValue()}'', that form will no longer work. Instead, RCC Workers \textit{must} use the documented form, \textit{e.g.} ``\path{BIAS_PARAM_BIASVALUE}''\footnote{These examples are from the \path{bias_param.c} worker, comparing 1.4 to 1.5.}.
\subsection{\ocpidev Changes}
\label{sec:15_ocpidev_changes}
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item The \code{show projects} command no longer shows tests and primitives with low verbosity (``\path{-v}''); use high verbosity instead (``\path{-vv}'')\footnote{Any automated parsing of data should be using JSON interface, which also needs this additional verbosity.}. % AV-4963
\end{itemize}
\subsection{``\code{myClock}'' HDL Code Deprecated / Removed} % AV-5235
\label{sec:15_myclock}
While revamping and examining the framework's ability to use multiple clocks within HDL Workers, it was found that the ``\code{myClock}'' capability was documented but likely never fully worked. This feature is \textit{planned} to be restored \textit{and tested} for the 1.6 release using a different XML attribute name.
\subsection{Infrastructure OWDs Moved} % AV-5172 AV-5173 AV-5174 AV-5175
Various OWDs\footnote{The OWDs explicitly were \path{metadata.xml}, \path{ocscp.xml}, \path{time_client.xml}, and \path{unoc_node.xml}.} were incorrectly located within the ``core'' Project's ``\path{specs}'' directory, even though they are infra\-structure Workers that an end user shouldn't need to be concerned with. They have been moved out to reduce confusion and clutter.
\subsection{RPM Upgrade Notes} % AV-5245
Some previous RPM-based installations may not have proper dependencies documented for some sub-packages, \textit{e.g.} version 1.4 of \path{opencpi-hw-platform-e3xx-xilinx13_4} requires ``\path{opencpi},'' not \textit{explicitly} ``\path{opencpi} version 1.4.'' This may cause version mismatches when upgrading; \textbf{ensure all packages currently installed on a system are \textit{explicitly} added to the \path{yum} command line when upgrading.}

\subsection{HDL Wrapper Changes} % AV-5271
\label{sec:15_hdl_wrappers}
The internal ``wrapper'' that encapsulates an HDL Worker has changed considerably (see \sref{sec:15_smart_wrappers}).
This has changed the pipeline depths of the inputs and outputs of the Workers.
\textbf{This \textit{should not affect} any users; an Application should \textit{never} make assumptions concerning, or require specific relationships between, the timing of data between Workers\footnote{Other ways timing may be affected would include backpressure from upstream Workers, network latency between remote Containers,  etc.}.}
However, if developers previously made implementation-specific assumptions, their Applications will now fail and will need to be fixed to properly use the Framework to transport \textit{all} required data and metadata.

\section{Major Known Deficiencies}
\label{sec:15_bugs}

\subsection{``udev'' Radio Rules Sometimes Does Not Work} % AV-5275
\label{bug:5275}
Starting with 1.4, some RPMs pre-install symlinks for rules in \path{/etc/udev/rules.d/} for certain radio platforms, \textit{e.g.} a rule to create a symlink from \path{/dev/matchstiq_z1_0} to \path{/dev/ttyUSB0}.
\input{snippets/udev_Reread}

\subsection{Emulators Not Constrained To Specific Containers In Unit Tests} % AV-5496
\label{bug:5496}
When an emulator-based test harness is built for multiple simulators (\textit{e.g.} ``isim'' and ``xsim''), running the unit test does not guarantee that all workers are running on the same container.
For example, when ``\path{lime_dac_ts.test}'' is built for both isim and xsim, test execution could pass for isim, but might later fail with xsim.
Review of the log file shows that the emulator worker is erroneously running on an isim container and not the expected xsim container.
The recommended workaround is to only build and test for a \textit{single} simulator at a given time, ensuring there is only one artifact that satisfies the test's requirements.

\subsection{Provided LiquidDSP Build May Link Incorrectly} % AV-5543
\label{bug:5543}
\textit{Note:} This bug \textit{only} affects source-based building; RPM-based users will not encounter this issue.\\

The ``LiquidDSP'' library is provided as a prerequisite of the ``assets'' Project.
It is currently used by one worker, ``\path{complex_mixer.rcc}'', which uses it for its Numerically Controlled Oscillator (NCO).
If the LiquidDSP library is built on a system that has the ``FFTW'' library installed, it will attempt to use it.
However, any user-developed RCC Worker attempting to use LiquidDSP functions that use the FFTW back-end will fail at runtime with an undefined symbol (\textit{e.g.} \path{fftwf_execute}).
The recommended workaround is to use the compiled \path{libliquid} from the RPM installation (\textit{e.g.} \path{/opt/opencpi/cdk/centos7/lib/libliquid.a} or \path{/opt/opencpi/cdk/xilinx13_3/lib/libliquid.a}) or to rebuild the prerequisites without the FFTW libraries installed.\\

This problem was found late within the 1.5 release cycle and will be addressed with the next major release.

\iffalse % Fixed in both RPM and source; will remove block in 1.6
\subsection{``python3'' Symlink Missing} % AV-5477, AV-5478
\label{bug:5477}
Some ``python3'' RPMs do not provide a default symlink from \path{/usr/bin/python3} to their proper executable\footnote{For example, CentOS~7's \path{python34-3.4.10-1.el7.x86_64} does not, while the slightly-older \path{3.4.9-2.el7.x86_64} did.}.
This is not considered a deficiency of the framework itself, but the Python packager.
If your system does not have \path{/usr/bin/python3}, a system administrator needs to create one for you pointing to your installation of Python3, \textit{e.g.} ``\code{cd /usr/bin; sudo ln -s python3.4 python3}'' for Python 3.4.
The \path{opencpi-devel} RPM works around this by installing a symlink, but non-RPM users \textit{may} need to manually create the symlink.
\fi

\subsection{Previously Documented Deficiencies}
The following deficiencies are still present in 1.5:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{693}
\item \bugref{1035}
\item \bugref{1392}
\item \bugref{2241}
\item \bugref{2400}
\item \bugref{2477}
\item \bugref{3193}
\item \bugref{3783}
\item \bugref{2811}
\item \bugref{4307}
\end{itemize}

The following previously-documented deficiencies have been fixed in this release:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{4173}
\item \bugref{4278}
\item \bugref{4486}
\item \bugref{4526}
\end{itemize}

% === End of 1.5

\beginoldnotes

\origsection{Release 1.4.0}
\section{Enhancements}

\subsection{Support for Ettus E310 Platform} % AV-4247
\label{sec:14_e310}
The Ettus Research USRP E310 is now supported within the OpenCPI framework. This includes the changes to the AD9361 device workers for using a CMOS interface, increasing the number of modes that the framework supports\footnote{AD9361 LVDS signaling has been supported since 1.3; cf. \ref{sec:13_ad9361}.} There is currently a limitation of a single TX and RX channel being supported; see the \textit{E3xx Getting Started Guide} for more information.

\subsection{Component Unit Test Enhancements} % AV-3149 and many other tickets
\label{sec:14_test}
The provided Component Unit Test infrastructure has been enhanced to automatically incorporate elements that address common issues when developing HDL workers:
\begin{enumerate}
\setlength\itemsep{0em} %tighten
\item Input message metadata manipulation applied to the Unit Under Test's (UUT) input port(s) helps ensure an HDL Worker can properly handle various message-protocol edge conditions, \textit{e.g.} start-of-message without data until a later clock. \textbf{This manipulation is \textit{not} enabled by default.}
\item Output message throttling applied to the UUT's output port(s). Not respecting ``backpressure'' is often the reason an HDL Worker fails on a ``real'' hardware platform after passing all tests within a simulation. \textbf{This backpressure is now enabled in \textit{all} test benches by default.}
\end{enumerate}
Exercising Workers in this manner during the simulation design phase has been shown to greatly increase the likelihood of success on physical hardware. More information can be found in the \textit{Component Development Guide}.

\subsection{Multi-Slave Proxy Support} % AV-2448
\label{sec:14_multislave}
Previously, a Proxy Worker could only represent a single Worker but not a collection of Workers that had related functions, \textit{e.g.} the transmit and receive paths of a single RF link. This resulted in various workarounds that are not officially supported by the Framework. For example, one user had a Proxy ``peeking'' into the Application to find peer Workers: this does not work with Remote Containers with the Application on another physical machine. Now a Proxy can (optionally) define more than one slave Worker with full interface compatibility with previous implementations \footnote{The interface of using an object named ``\code{slave}'' remains. The type of the object is considered an implementation detail and \textit{has} changed.}. More information can be found in the \textit{Component Development Guide}.

\subsection{Transmit Blanking / Powerdown for DACs} % AV-4273
\label{sec:14_blanking}
Both the AD9361 and LIME DACs are now blanked / powered down\footnote{Implemented by TX RF carrier suppression} when not in use. To perform this on-demand, they use a new ``\code{tx\_event}'' Port/Protocol, as well as properties exposed in their proxies. See the respective Worker datasheets for more details. \textbf{This added capability resulted in a change to the \code{qdac-spec} that may affect current user applications.} If an application used \code{connect=qadc} (\code{connect} attribute), that application will require an additional \code{to} attribute specified directing it to explicitly use the \code{IN} input port.

\subsection{\ocpidev Improvements} % AV-3439 et al
\label{sec:14_ocpidev}
The \ocpidev tool has been significantly improved, including:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \code{run} some Applications
\item \code{run} Unit Tests
\item \code{show} Unit Tests within a Project
\item \code{show} additional Project information
\end{itemize}
See \ref{sec:14_ocpidev_changes} for \ocpidev command changes.

\subsection{VHDL-Native Pattern and Capture HDL Workers} % AV-4118
\label{sec:14_pattern_capture}
The \code{pattern\_v2} and \code{capture\_v2} Workers have been written from the ground up in VHDL to replace the machine-generated Verilog-sourced \code{pattern} and \code{capture} Workers. \textbf{These latter Workers are now considered deprecated.} The new Workers include fully-functional test benches and data sheets. Platform and BSP Developers will find these Workers to be very useful when debugging various issues related to low-level OpenCPI development.

\subsection{New Documentation RPM} % AV-4267
\label{sec:14_docrpm}
In addition to the PDF-based documentation available at \href{http://opencpi.github.io/}{github.io}, a new RPM is now included ``\verb+opencpi-doc+,'' which includes most of that documentation. Most of the PDFs are installed into \code{/usr/share/doc/}\footnote{The Fedora/Red Hat standard documentation location.}, but a convenience symlink can be found at \code{/opt/opencpi/documentation.html}. This path should not change across multiple OpenCPI versions and can be passed directly to most browsers, \textit{e.g.} ``\code{xdg-open /opt/opencpi/documentation.html}''. If you receive the RPM directly from the AV team, it may include BSP documentation that is not available on GitHub.

\subsection{Zynq Parts Defined} % AV-4356
\label{sec:14_zynq}
All Zynq-based Xilinx parts that are supported by the current Framework, but not necessarily used in an OpenCPI-supported platform, have been defined within the Framework build system. This means that an end user creating a BSP for a ``larger fabric'' Zynq-7000, \textit{e.g.} xc7z100, will not need to change any Framework files and have all required changes isolated to a single Project. This does \textit{not} include additional platforms that have different internal configurations, e.g. Zynq-UltraScale+ devices.

\section{Changes and Notes}
\subsection{I/Q Data Ordering} % AV-4310 AV-4311 AV-4327
\label{sec:14_iqdata}
As noted in the \textit{HDL Development Guide}, when a Protocol contains a Struct Argument, the first Argument Member defined in the Protocol's XML is \textit{always} in the \textit{least significant} bits of the resulting Port. A good example of the importance of this is the scenario where a Port's default data width is overridden (in the OWD) to present all of a Struct's Members in parallel within a single clock cycle. For example, \code{iqstream\_protocol}'s default ordering is a 16-bit interleaved I/Q data: ``$I_{t=0}, Q_{t=0}, I_{t=1}, Q_{t=1}, I_{t=2}, ...$''. However, if the Worker configures its data Ports to be a width of 32 bits, then the I/Q data is presented as a parallel I/Q sample pair with ``I'' in the \textit{lower} 16 bits and ``Q'' in the \textit{upper} 16 bits, \textit{i.e.}:
\begin{center}
$I_{0}=InPort_{0}[15:0]; Q_{0}=InPort_{0}[31:16]\newline
I_{1}=InPort_{1}[15:0]; Q_{1}=InPort_{1}[31:16]\newline
$
\end{center}
The following Application and Workers were identified as improperly handling \code{iqstream\_protocol} complex data (I/Q) presented in the manner noted above and have been corrected:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \path{assets/components/dsp_comps:}
\begin{multicols}{3}
\subitem \path{cic_dec.hdl}
\subitem \path{cic_int.hdl}
\subitem \path{complex_mixer.hdl}\footnotemark
\subitem \path{complex_mixer.rcc}\footnotemark[\value{footnote}]\footnotetext{See last paragraph as well concerning Property changes.}
\subitem \path{dc_offset_filter.hdl}
\subitem \path{fir_complex_sse.hdl}
\subitem \path{iq_imbalance_fixer.hdl}
\subitem \path{phase_to_amp_cordic.hdl}
\subitem \path{pr_cordic.hdl}
\subitem \path{rp_cordic.hdl}
\end{multicols}
\item \path{assets/hdl/devices:}
\begin{multicols}{3}
\subitem \path{ad9361_dac.hdl}
\subitem \path{lime_dac.hdl}
\subitem \path{lime_dac_ts.hdl}
\end{multicols}
\item \path{assets/applications}
\begin{multicols}{3}
\subitem \path{FSK}
\subitem \path{Rx_App}
\end{multicols}
\end{itemize}

It is important to note that this list includes various DACs as well as the \path{complex_mixer}, meaning that \textbf{user's RF Applications from previous versions of the Framework \textit{may} need to be updated}, \textit{e.g.} to handle this change in the DAC's interpretation of data presented for transmission. Also related to this, the \path{phs_inc} Property of \path{complex_mixer} may require inversion when compared to previous versions.

\subsection{Upgrade Notes}
If you have previous versions of the RPM-based OpenCPI RPMs installed, they must all be manually removed, including the prerequisites. \textbf{There is no automatic upgrade path.} Manually performing ``\code{sudo rm -rf} \path{/opt/opencpi/prerequisities}'' after uninstalling \textbf{all} previous RPMs \textit{may} also be needed.

\subsection{Significant SD Card Layout Changes} % AV-4419
\label{sec:14_sdcard}
There have been significant changes to the layout of the Framework and its support files. These are mostly implementation details that the end user does not need to be concerned with. However, scripts and paths that are used for embedded development (both locally and using NFS mounts) have changed enough that users should wipe any SD cards they have used and follow the directions given in the respective platform's \textit{Getting Started Guide} to create a new one.

\subsection{Intel Quartus and Quartus Pro Version Change} % AV-3972
This release has been tested with Quartus Standard 17.1 which is a newly supported version of the tool. Version 15.1 should still work, but future versions will be tested with 17.1. Additionally, preliminary support for Quartus Pro 17.0.2 is also available within the Framework, but is not used by any platforms at this time.

\subsection{New Input Port ZLM-Handling Primitive} % AV-4484
For an HDL Worker to handle the \textit{de facto} end-of-stream signaling used by the Component Unit Test infrastructure (a ZLM with OpCode 0), a convenience primitive is now available and found at \path{projects/core/hdl/primitives/util/zlm_detector.vhd} with an example implementation shown in the \path{capture_v2.hdl} Worker.

\subsection{Change in QDAC/QDAC\_TS Component Spec}
The QDACs now have two ports. The ``\code{IN}'' ports have not changed, but some applications may need to be updated if they did not explicitly connect to them. See \ref{sec:14_blanking} above for more information.

\subsection{Change in \ocpidev Default Output and Scope}
\label{sec:14_ocpidev_changes}
Some of the output from \code{ocpidev}'s \code{show} has changed to default to being more ``human friendly'' and reporting in a tabular fashion (\code{--table}). Many of these commands retain a \code{--simple} parameter for quick parsing. Most also support \code{--json}, which is the recommended and most stable method of parsing \ocpidev output.\newline

Some of \code{ocpidev}'s \code{show} commands now have the concept of ``scope'' where the user is requesting a list of \textit{somethings} provided by a single project, or \textit{all somethings} available within all registered Projects. At this time, no commands support both of the scoping arguments \code{--global-scope} and \code{--local-scope}. However, to ensure future \ocpidev enhancements remain compatible with user scripts, some commands will force the user to explicitly specify a scope if the ``reasonable'' not-yet-implemented default is not yet ready. For example, in a future release, ``\code{ocpidev show tests}'' will report \textit{all} Unit Tests that are available. That report is not yet available, so the user \textit{must} currently explicitly scope the request with ``\code{ocpidev show tests --local-scope}''. However, something like ``\code{ocpidev show registry --local-scope}'' would make no sense, so will never be supported.

\subsection{Rounding and Truncation in \code{qdac-spec} Workers} % AV-4387 AV-4388 AV-4389
\label{sec:14_rounding}
Various DACs were found to be improperly casting \textit{signed} data to \textit{unsigned} during certain operations, resulting in an overflow when the maximum value was transmitted.

\subsection{HDL Workers Failing Unit Tests That Previously Passed}
If a user experiences Unit Test failures that were not present in previous releases, the most likely cause is that ``backpressure'' is now automatically asserted by default; see \ref{sec:14_test} for details.

\subsection{New Framework Build System} % AV-4362
\label{sec:14_build2}
The OSS OpenCPI Project has migrated the Framework build system to a new custom-made system that produces RPMs directly\footnote{If a user was building custom RPMs (from the \path{releng} directory), the process has changed considerably.} and removes the need for ``prerequisite'' RPMs. If upgrading from a previous RPM-based installation, the prerequisite RPMs might require manual deletion. Any mention of prerequisite RPMs in the Appendices (\textit{e.g.} \ref{sec:11_prereq}) below can likely be ignored.

\subsection{New RCC Platform Configuration} % AV-4371
Prior to 1.4, RCC Platforms were defined in \path{/projects/core/rcc/platforms}. With 1.4, they can be in the \path{/rcc/platforms} directory of any Project. \textit{The Platform Development Guide} defines how RCC Platforms are \textit{now} defined and a condensed migration guide can be found at \path{projects/core/rcc/platforms/README.migrating} .

\section{Major Known Deficiencies}
\label{sec:14_bugs}

\subsection{ZedBoard IP Required Even In Standalone Mode} % AV-4173
\label{bug:4173}
Applications (including XML-only ones) fail if there is not an IP address assigned to the ZedBoard, even when in ``standalone mode.'' If the network connection is not used, forcing a MAC (cf. Section~\ref{bug:2400}) and IP addresses is required. To set a temporary IP address, the command ``\code{ifconfig eth0 192.168.244.244}'' can be used. This problem was found late within the 1.4 release cycle and should be addressed with the next major release.

\subsection{Connection Direction In GUI Assumes XML order} % AV-2811
\label{bug:2811}
When importing hand-written XML into the GUI, the \texttt{to} and \texttt{from} attributes are ignored on connections. This does not affect any XML generated by the GUI.

\subsection{OnlyPlatforms/ExcludePlatforms Does Not Work For Individual Unit Test Cases} % AV-4278
\label{bug:4278}
You can include and exclude platforms at a full-test level, but individual cases currently ignore the directives.

\subsection{Some HDL Workers Will Need To Be Updated When \code{props\_in.raw.address} Width Fixed} % AV-4307
\label{bug:4307}
The ``raw'' address scheme for HDL workers is documented as a 32-bit bus. In testing, it was found that this is currently implemented as only 16 bits. While this has \textit{not} yet been fixed, users should review their own libraries for any Workers that make assumptions concerning the size of the bus. Any \code{raw.address} access should be written in more generic VHDL, \textit{e.g.}:
\begin{lstlisting}[language=diff]
-        event_rawprops.raw.address <= x"0040"; --TXRF modules enable register
+        event_rawprops.raw.address <= (6 => '1', others => '0'); --TXRF modules enable register (0x40)
\end{lstlisting}

\subsection{Default \code{python} Must Be Python2} % AV-4526
\label{bug:4526}
According to the \href{https://www.python.org/dev/peps/pep-0394/}{PEP-394} specification, system-level \code{python} \textit{should} point to a 2.x version of the Python interpreter. Some scripts within the Framework and Unit Tests \textit{require} this configuration.

\subsection{Some \code{ocpi.assets} Workers Have Flow Control Issues} % AV-4486
\label{bug:4486}
The Component Unit Test infrastructure has been enhanced (cf. Section~\ref{sec:14_test}) and deficiencies within some Workers have been revealed during regression testing. The following \code{ocpi.assets} Workers are currently known to have defects which will be fixed in a future release:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\begin{multicols}{3}
\item[] \path{bias_ver.hdl}
\item[] \path{cic_dec.hdl}
\item[] \path{cic_int.hdl}
\item[] \path{fir_complex_sse.hdl}
\item[] \path{fir_real_sse.hdl}
\end{multicols}
\end{itemize}

\subsection{Previously Documented Deficiencies}
The following deficiencies are still present in 1.4:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{693}
\item \bugref{1035}
\item \bugref{1392}
\item \bugref{2241}
\item \bugref{2400}
\item \bugref{2477}
\item \bugref{3193}
\item \bugref{3783}
\end{itemize}

The following previously-documented deficiencies have been fixed in this release:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{1385}
\item \bugref{1585}
\end{itemize}

% === End of 1.4

\origsection{Release 1.3.1}
\label{sec:appendices}
\section{Enhancements}
\begin{itemize}
\item All documentation has now been updated to cover 1.3 capabilities and features
\item Bugfixes and enhancements for AD9361
\item Workarounds for bug noted in Section~\ref{bug:3783}
\item USB Blaster \code{udev} rules fixed
\item \code{ocpizynq} tool fixed
\end{itemize}

\section{Changes and Notes}
None to report.
\section{Major Known Deficiencies}
\begin{itemize}
\item \textit{Note}: no other deficiencies from Section~\ref{sec:13_bugs} have been mitigated and all remain.
\end{itemize}
\subsection{PCI Platforms Can Only Transmit Using One Channel} % AV-3783
\label{bug:3783}

The current implementation of the PCI-e Specification (ALST4 and ML605 platforms) only allows DMA transaction from the host to the platform on the \textit{first External Port defined in the Assembly or Container XML}. This means the \textit{input} to any Assembly/Container should be listed first. See
\path{projects/assets/hdl/assemblies/empty/cnt_1rx_1tx_bypassasm_fmcomms_2_3_hpc_LVDS_ml605.xml}
as an example. \textit{This does not affect any Zynq-based platforms.} This problem was found late within the 1.3 release cycle and should be addressed with the next major release.

\newpage
\origsection{Release 1.3}
\section{Enhancements}
\label{sec:13_enhancements}
\subsection{OSS Release} % AV-2575 and many other tickets
\label{sec:13_oss}
ANGRYVIPER Team's build of OpenCPI is now available on GitHub under the OpenCPI Organization. The first release is in a git branch, but full integration is planned in the future. This includes all of the previously-proprietary ``ocpiassets / Assets'' Project, including the Board Support Package (BSP) for Epiq Solutions' Matchstiq Z1.

\subsection{Python and GNU Radio Integration (Technology Preview)} % AV-3699
There are now SWIG bindings available to allow a top-level Python script to use the ACI to manipulate an Application in the same manner as from C++\footnote{This integration is only available on CentOS 7 platforms.}. One use case is a GNU Radio block that allows GNU Radio Companion to handle the entire lifecycle of an OpenCPI Application. This block can handle data flows of complex I/Q streams or any primitive data type (\textit{e.g.} floats or bytes) in and out of the Application. A reference implementation of this block is provided in OpenCPI's fork of GNU Radio Companion.\\

This fork of GNU Radio Companion also allows for Application and HDL Assembly building, as well as deployment independent of the ANGRYVIPER GUI. Some of this capability was presented at the GNU Radio Conference GRCon17; the video is available on \href{https://www.youtube.com/watch?v=CriLitW5vtM}{YouTube}.

\subsection{AD9361 Support}
\label{sec:13_ad9361}
The popular Analog Devices, Inc's AD9361 RF transceiver IC is now supported via a series of Device Workers. The modularity of these workers eases AD9361 transceiver integration with future FPGA systems. Most of the major AD9361 features are supported, including RX/TX RF digitization/data streaming and RF tuning/gain control. The AD9361 Device Workers currently only fully support some operating modes, but contain infrastructure in anticipation of future expansion. These device workers utilize the vendor's \href{https://github.com/analogdevicesinc/no-os}{No-OS software library} for high-level control.\\

There is also ``card'' support for the FMCOMMS2 and FMCOMMS3 evaluation/prototyping RF transceiver FMC cards centered on the AD9361. The newly released \code{ocpi.assets} Project includes a single-channel RX narrowband I/Q stream to file (\path{applications/rx_app}) and single-channel RX/TX FSK modem (\path{applications/FSK}) reference applications, which each support the FMCOMMS2 and FMCOMMS3 card on the zed platform.

\subsection{GUI Improvements}
Since 1.2, the GUI has multiple improvements, some of which are:

\begin{itemize}
\item \textbf{The ability to build OpenCPI Assets} - The Component and Application developer can now build without the command line. The build tool allows RCC and HDL compilation from numerous levels in a Project from individual assets to the entire Project. The tool also allows the developer to build and run Component unit tests while allowing multiple concurrent builds in separated tabbed consoles.

\item \textbf{New Perspective} - This Eclipse Perspective is the new presentation of the build tool. It consists of a number of views where three are specific to OpenCPI.

\item \textbf{Project Explorer view} - This view allows simple navigation to select items to build and provides a way forward to provide OpenCPI features without having to explore the file system.

\item \textbf{OpenCPI Operations Panel} - Selections can be placed in this panel and built for all available RCC and HDL Targets and/or Platforms.

\item \textbf{Build Status View} - Provides a simple graphical presentation of the launched build or test run and its status (\textit{e.g.} running). The user may also re-run build, clean, or run executions from this view and bring the build console window forward.

\item \textbf{New HDL Platform Editor} - The HDL developer can now create and view HDL platform XML in a graphical presentation.
\end{itemize}

\subsection{Project Registry} % AV-3028
\label{sec:13_proj_registry}
Release 1.3 introduces a new concept of ``Project Registry'' to organize and interrelate a set of Projects which allows Projects to be moved (cf.  \ref{sec:13_proj_moved}) as well as present an explicit relationship between them, \textit{e.g.} ``\textit{this} copy of \code{ocpi.assets} was built based upon \textit{that} copy of \code{ocpi.core}.'' Registry manipulation is performed using \ocpidev (cf. \ref{sec:13_ocpidev}).\\

The default configuration is that every Project on a machine shares a single Registry (located at \path{/opt/opencpi/project-registry}). A user must be in the Unix group ``\code{opencpi}'' to manage this global Registry.\\

This new capability deprecates the previously-used \code{OCPI\_PROJECT\_PATH} build-time variable as well as the scripts \path{freeze_project.sh} and \path{thaw_project.sh} noted in \ref{bug:3031}.

\subsection{Project Migration} % AV-3031
\label{sec:13_proj_moved}
With the new Project Registry (cf. \ref{sec:13_proj_registry}), Projects can now be moved to new locations or archived and then restored on another machine with the use of the \code{ocpidev unregister} and \code{ocpidev register} commands. This mitigates the previously-documented deficiency found in \ref{bug:3031}.

\subsection{\ocpidev Improvements} % AV-2583
\label{sec:13_ocpidev}
The ``\ocpidev'' command has been improved in various ways, including:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \code{bash} completion for many commands (try \code{ocpidev <tab><tab>})
\item Ability to show possible HDL platforms: \code{ocpidev show hdl platforms --table}
\item Ability to show possible RCC platforms: \code{ocpidev show rcc platforms}
\item Ability to build unit tests
\item Project Registry (\ref{sec:13_proj_registry}) manipulations
\end{itemize}

\subsection{RCC Platforms}
\label{sec:13_rcc_platforms}
With the new Project Registry (cf. \ref{sec:13_proj_registry}), RCC Platforms can now be defined exclusively within a Project outside of the CDK / Core Project. An example of this can be seen in the \code{inactive} project under \path{rcc/platforms/macos10_13}. This improvement allows BSPs to be self-contained within a Project.

\subsection{Remote Containers (Technology Preview)}
The full-OSS OpenCPI code base has imported previously-written code that allows Remote Containers. This code has not yet been evaluated by the ANGRYVIPER Team.

\subsection{OpenCL Containers (Technology Preview)}
The full-OSS OpenCPI code base has imported previously-written code that allows OpenCL (``OCL model'') Containers on CPUs and GPUs. This code has not yet been evaluated by the ANGRYVIPER Team.

\section{Changes and Notes}
This section describes items that may cause users of previous versions to modify their code, build system, etc.

\subsection{Major Project Restructuring} % AV-3048, AV-3411, AV-3568
\label{sec:13_restructure}
Starting with Release 1.3, the CDK is no longer a top-level Project. All Components that were previously found in the CDK, \textit{e.g.} \code{file\_read}, have migrated to \code{ocpi.core}. The previously-documented ``Base Project'' has been removed; it was the RPM-specific manner of separating the CDK from the core components needed to run OpenCPI. The various items (cards, devices, specs, etc) that were previously found in the Base Project have been distributed into one of three new Projects. The previously non-OSS proprietary items have been redistributed within the new Projects as well. The Projects are:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \code{ocpi.core} - Core items for the Framework
\item \code{ocpi.assets} - Items fully-supported by the ANGRYVIPER Team
\item \code{ocpi.inactive} - ``Everything else''
\end{itemize}

These items being moved will cause Application XML to possibly fail, \textit{e.g.} anything calling for the \code{ocpi.file\_read} spec now needs to look for \code{ocpi.core.file\_read}. There is a similar rename of \code{ocpiassets} $\Rightarrow$ \code{ocpi.assets}.\\

There is a provided utility script (\path{/opt/opencpi/cdk/scripts/upgradeApp_v1_3.py}) to assist in this migration. This script will modify the package information for the specs required. There are three ways it can be called:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item If given a single argument (the Application XML file name), it will write the same name with \code{updated\_} prepended.
\item If given a second argument, the modified file will be written to that file name.
\item If the second argument is \code{same}, the original file will be overwritten.
\end{itemize}

This change also removes the \path{/opt/opencpi/base_project_source/new_base_project.sh} script found in earlier releases; its equivalent is now \path{/opt/opencpi/projects/new_project_source}, which uses the same arguments as noted in the \textit{Getting Started Guide}.

\subsection{Upgrade Notes} % AV-3240
% The RPMs are designed to allow direct upgrading to newer versions. However, if previous versions of some of the prerequisite RPMs are \textit{uninstalled}, some empty directories may remain, blocking the installation of the current RPMs.
If you have previous versions of the RPM-based OpenCPI RPMs installed, they must all be manually removed, including the prerequisites. \textbf{There is no automatic upgrade path.} Manually performing ``\code{sudo rm -rf} \path{/opt/opencpi/prerequisities}'' after uninstalling \textbf{all} previous RPMs \textit{may} also be needed.

\subsection{Prerequisite RPMs Built With Newer Language Standards} % AV-2670, AV-2601
All prerequisites are now built with the C++11 or the C98 standard implemented. This will increase interoperability and avoid ambiguous situations, \textit{e.g.} the size of a \code{bool} variable.

\subsection{Legacy Platform Names Continue to be Deprecated} % AV-2983
The legacy suffix ``\code{\_pf}'' for simulator platforms, \textit{e.g.} \code{isim\_pf}, is not supported when running unit tests. Unit tests were introduced after the suffix was deprecated, so the effect on end users should be minimal.

\subsection{OCPI\_XILINX\_VIVADO\_DIR Variable Changed} % AV-3220
A bug in Release 1.2 required the variable to be set ``deep'', \textit{e.g.} \path{/data/Xilinx/Vivado/2017.1}. You \textit{must} now set it to the top-level value, \textit{e.g.} \code{/data/Xilinx}. If a specific version of Vivado is required, \code{OCPI\_XILINX\_VIVADO\_VERSION} should be set, \textit{e.g.} \code{2017.01}. As a reminder, these variables only apply if you have both ISE and Vivado installed in different base directories, \textit{e.g.} ISE in \path{/opt/Xilinx} vs. Vivado in \path{/data/Xilinx}.

\subsection{\ocpidev and Requesting RCC Platform To Match HDL Platform} % AV-3457
When building Projects with \ocpidev, the user can tell the build system to automatically select the proper RCC Platform when given an HDL Platform. This option is \code{--rcc-hdl-platform} with a mnemonic of ``build \textit{this} RCC Platform for \textit{that} HDL Platform.'' Previous Releases had the flags backwards (``\code{--build-hdl-rcc-platform}''). This is incorrect and has been deprecated.

\subsection{zero\_padding Component in \texttt{ocpi.assets} deprecated}
In the FSK reference application, \path{zero_padding.hdl} was replaced by two new Workers, \path{zero_pad.hdl} and \path{mfsk_mapper.hdl}. The change was made because \path{zero_padding.hdl} performed two functions: binary FSK mapping and inserting zeros between symbols. Whenever possible, functions should be separated into their own Components for increased flexibility and reuse. The \path{zero_padding} Component will be removed in Release 2.0.

\section{Major Known Deficiencies}
\label{sec:13_bugs}

\subsection{Previously Documented Deficiencies}
The following deficiencies are still present in 1.3:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{693}
\item \bugref{1035}
\item \bugref{1385}
\item \bugref{1392}
\item \bugref{1585}
\item \bugref{2241}
\item \bugref{2400}
\item \bugref{2477}
\item \bugref{3193}
\end{itemize}

The following previously-documented deficiencies have been fixed in this release:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{1645}
\item \bugref{3031}
\item \bugref{3099}
\item \bugref{3107}
\item \bugref{3109}
\end{itemize}

The following previously-documented deficiencies will \textit{not} be fixed:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{3170}: It was determined that this is not a bug. For primitive cores, if a user sets the \code{SourceFiles} variable, they must explicitly list all files, including \path{*_pkg.vhd} files. This is true for \textit{all} platforms.
\end{itemize}

% === End of 1.3

\newpage
\origsection{Release 1.2}
\section{Enhancements}
\subsection{Vivado Support for Applicable Xilinx-Based Platforms} % AV-78, AV-2897, AV-3126
\label{sec:12_vivado}
By far the \#1 requested feature by OpenCPI users, the Framework now supports the use of Xilinx's Vivado on the appropriate Platforms. \textbf{This toolchain is now the default} where applicable (mostly Zynq-based), and it is highly recommended that users of Xilinx-based platforms review the provided \textit{Vivado Usage Guide}.\\

End users should be aware (see \textit{Vivado Usage Guide} for more details) that:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item If you simulate with ModelSim, you may need to upgrade. Vivado requires a minimum version of 10.5c (tested by ANGRYVIPER Team using 10.6a)
\item If your design requires the use of Xilinx CORE Generator IP (\path{coregen}) items, they must be regenerated with Vivado to be \textit{simulated} in XSIM. Your existing \texttt{ngc} files from ISE can continue to be used for \textit{synthesis}, but porting to new \textit{Vivado IP} is recommended.
\item There is a new platform, \path{zed_ise}, that is intended for testing purposes, but released with the distribution. This platform is the ZedBoard using the Xilinx ISE tool chain.
\end{itemize}

\subsection{New command option ``\code{ocpidev build}''} % AV-2584
To help improve the end-user experience, OpenCPI 1.2 requires less command-line usage of ``\texttt{make}''. The previously-available tool \ocpidev now has a ``\texttt{build}'' verb available. More information can be found in the (OSS) \textit{Component} and \textit{Application Development Guides}.

\subsection{GUI Now Delivered as RPM} % AV-2642
\label{sec:12_guirpm}
There is now an \path{opencpi-ide} RPM included in the distribution. A separate installation of Eclipse for each end user is no longer required. Once installed, any user can launch with the \path{ocpigui} command.

\subsection{Artifact Version Checking} % AV-2226, AV-2453
While backwards compatibility is a major goal of OpenCPI, binary compatibility across versions is \textit{not} guaranteed. Every artifact should always be rebuilt with the latest framework. To enforce this requirement, the framework will check all artifact metadata at deployment time to verify the version used to build. Version 1.1 inserted the proper metadata, but the comparison is new in 1.2, allowing 1.2 to recognize and reject 1.1 artifacts. Artifacts rejected for no other reason will issue a warning message at all debugging levels. This behavior can be overridden by setting the environment variable \path{OCPI_ALLOW_VERSION_MISMATCH} to ``1''; \textit{this is not recommended}.

\subsection{Miscellaneous Improvements}
A quick list of improvements not documented above include:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item Cross-platform ACI builds using \texttt{ocpidev}-generated applications previously failed % AV-2645
\item Picoflexor T6A Software updated to vendor's Drop 5.5.2 % AV-2549
\item \texttt{ocpiassets} project can now be imported into GUI % AV-2775
\item Proxies can now use string properties\footnote{This is noted here because it is one of the first user reported bugs.} % AV-2649
\end{itemize}

\section{Changes and Notes}
This section describes items that may cause users of previous versions to modify their code, build system, etc.

\subsection{rx-spec and tx-spec Support Property Interdependence} % AV-2679
Certain front-ends have different ranges based other properties, \textit{e.g.} the current sample rate, requiring some properties that were previously ``Initial'' (immutable) to have their restrictions relaxed. \textit{This compatibility break should only affect platform developers,} unless applications were incorrectly caching these values. All interfaces above that level should be unaffected.

\subsection{Vivado Support}
Please see \ref{sec:12_vivado} for modifications that \textit{may} need to be performed.

\section{Major Known Deficiencies}
\subsection{Driver Failing to Allocate Memory on Zynq-Based Platforms} % AV-1645, AV-3040
\label{bug:1645}
In some situations after repeated multi-model (RCC and HDL) application runs on Zynq-based platforms (e.g. ZedBoard), the kernel driver will fail to allocate contiguous memory for DMA data transfers. On x86-based platforms, memory for this use is allocated at boot time before memory fragmentation. Currently, no memory is being allocated at boot time for the Zynq-based platforms. Single ocpirun or ACI application runs from the command line do not present any errors. When running an app in a long loop, such as in the unit test framework, or an application that writes a large amount of data (approx. 1GB) to file, this error \textit{may} occur.

\subsection{HDL Workers Cannot Send SOM Without Valid Data} % AV-3099
\label{bug:3099}
Although the HDL Component documentation claims the Framework's internal protocols support a separate Start-of-Message independent of valid data designations, this sequence causes the Component's output port to ignore any remaining data. This was found late within the 1.2 release cycle and should be addressed with the next release.

\subsection{SDP Cannot Handle More Than One ZLM Per Application Run} % AV-3109
\label{bug:3109}
The SDP transport will not propagate a second ZLM, so at this time the \textit{only} ZLM should be an implied end-of-application transmission. This problem does not exist when communicating between RCC-only Workers. Related to, but independent of \ref{bug:3107}. (See also \ref{sec:101_zlm}.)

\subsection{File\_Read and File\_Write Cannot Handle ZLM Mid-file} % AV-3107
\label{bug:3107}
\path{file_read} (HDL implementation) and \path{file_write} (RCC and HDL implementations) will stop if a Zero-Length-Message (ZLM) is found when operating in ``message mode'' regardless of the location within the file. Related to, but independent of \ref{bug:3109}. (See also \ref{sec:101_zlm}.)

\subsection{PCI-Based Platforms Not Always Detected in Remote Tests} % AV-2477
\label{bug:2477}
Using \path{OCPI_REMOTE_TEST_SYSTEMS}, JTAG connection problems have been observed, possibly related to system reboots. They seem to be resolved after disconnecting and reconnecting the USB cable.

\subsection{Built Projects Cannot Be Moved} % AV-3031
\label{bug:3031}
When a Project is built, the dependencies of each artifact and other support files are captured. Some of these contain absolute paths pointing to where the Project is currently located. The distribution includes a pair of \textit{unsupported} scripts that \textit{may} allow movement of Projects. They can be found in \path{/opt/opencpi/cdk/scripts/} and are named \path{freeze_project.sh} and \path{thaw_project.sh}.

\subsection{Properties Before Raw Properties Cannot Have Parameterized Lengths} % AV-2241
\label{bug:2241}
``Raw properties'' start at a certain property with the properties before that being ``non-raw'' properties. Currently, none of these ``before'' properties can have their length be set by an expression dependent on another parameter property.

\subsection{XML Parser Mixed-Case Issue} % AV-1385
\label{bug:1385}
The XML parser does not always recognize tags if differently-cased versions of the same tag are in the same XML file, \textit{e.g.} an OAS having both \texttt{<Instance .../>} and \texttt{<instance .../>} XML tags will fail. Users of the GUI should not be affected.

\subsection{Simulation of Primitive Cores Needs \texttt{Makefile} Modified} % AV-3170
\label{bug:3170}
When designing a Primitive vendor-specific core that is intended for simulation, the required \path{*_pkg} file containing the core's stub must be explicitly listed first in the \path{Makefile}'s \texttt{SourceFiles} variable.

\subsection{Lime RX/TX Proxy Tests on CentOS6} % AV-3193
\label{bug:3193}
The proxy tests for the Lime transceiver use a feature of C++11 that is not supported by the compiler in CentOS 6. The workaround is to use similar code to the following in the various places \verb+to_string()+ was used:
\begin{lstlisting}[language=diff]
-      std::string ClkInStr;
-      ClkInStr = to_string(2 * sample_rate * 1e6).c_str();
+      std::ostringstream ostr_clkin;
+      ostr_clkin << (2 * sample_rate * 1e6);
+      std::string ClkInStr(ostr_clkin.str());
\end{lstlisting}

\subsection{Previously Documented Deficiencies}
The following deficiencies are still present in 1.2:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item \bugref{693}
\item \bugref{1035}
\item \bugref{2400}
\item \bugref{1392}
\item \bugref{1585}
\end{itemize}

\section{Addenda to Previous Release Notes}
% Keep these in order of section
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item The default \texttt{CWD\_MAX\_LENGTH} noted in \ref{sec:11_cwd} is now set to 256. % AV-3119
\item The Liquid RPMs referenced in \ref{sec:11_prereq} are now \textbf{required} to build the \texttt{ocpiassets} project (\path{complex_mixer.rcc}). They are still considered optional when installing.
\end{itemize}

\newpage
\origsection{Release 1.1}
\section{Enhancements}
A quick list of improvements include:
\begin{itemize}
\setlength\itemsep{0em} %tighten
\item Simulatable Data Plane: Allows HW and SW co-simulation to test
integration between heterogeneous Workers
\item Scalable Data Plane: Allows Platform Workers to more efficiently use wider data paths on future platforms, e.g. a 128-bit bus instead of 32-bit\footnote{Currently limited to some Zynq-based platforms.}
\item New automatic test harness creation, including limited remote platform support\footnote{Most \texttt{ocpiassets} have been moved to the new test system to provide examples.}
\item Automatic bus width adaption between HDL Workers
\item Additional Assets components to help design and debug Applications
\item HDL Simulator on-the-fly launching\footnote{See Section~\ref{sec:11_simulators} for more information.}
\item Extended GUI capabilities
\item Official CentOS~7 driver support
\item Split platform names more explicitly between hardware and software platform types
\item Many fields in XML that require numerical values can now have mathematical calculations % AV-1641
\item Added platform support (Picoflexor RCC-Only)
\end{itemize}

\subsection{Debug Symbols for Framework Now Available}
% AV-2101
An RPM containing most debug symbols for the Framework (\code{opencpi-debuginfo-*.x86\_64.rpm}) is now provided. This greatly enhances the debugging of RCC Workers using industry-standard debuggers such as \texttt{gdb} and \texttt{ddd}.

\subsection{Kernel Driver Memory Arguments}
In previous versions, the ``\texttt{memmap}'' argument was given to the Linux kernel command line. This can conflict with other software that may also require reserved memory. If the user requires the reservation of more than one memory area using the \texttt{memmap} option, the OpenCPI driver will:
\begin{itemize}
\setlength\itemsep{0pt} %tighten
\item Assume the first \texttt{memmap} is for its use
\item Explicitly use the range/subrange marked with an additional \texttt{opencpi\_memmap}. \textit{The original \texttt{memmap} must still be provided} for the kernel to make the reservation.
\end{itemize}
% AV-268
See \path{/opt/opencpi/driver/README} for more information, including usage examples and configuration.

\subsection{HDL File\_Read and File\_Write CWD}
\label{sec:11_cwd}
% AV-977
The HDL Workers implementing the \texttt{File\_Read} and \texttt{File\_Write} specs distributed in 1.0 failed if used in a directory that exceeded 100 characters deep. There is an additional parameter \texttt{CWD\_MAX\_LENGTH} on these Workers that can be increased to allow deeper directories when needed.

\section{Changes and Notes}
This section describes items that may cause users of previous versions to modify their code, build system, etc.

\subsection{Simulators Renamed and Work Out-of-the-Box}
\label{sec:11_simulators}
% AV-1889, AV-2279
The simulator platform names have been renamed to remove the ``\_pf'' suffix, \textit{e.g.} \texttt{isim}. The \texttt{isim}\footnote{Only version 14.7 without rebuilding the Base Project.} and \texttt{modelsim} simulation platforms can now be targeted once the appropriate environment variables are set, \textit{e.g.} \texttt{OCPI\_MODELSIM\_DIR}. With \texttt{ocpirun} able to launch simulations, the usage of ``\texttt{ocpihdl simulate}'' is now deprecated and does nothing.\\
~\\
\begin{minipage}{\linewidth}
An example:
\begin{verbatim}
$ ocpirun -C
Available containers:
 #  Model Platform       OS     OS-Version  Arch     Name
 0  hdl   isim                                       lsim:isim
 1  hdl   modelsim                                   lsim:modelsim
 2  rcc   centos7        linux  c7          x86_64   rcc0
\end{verbatim}
\end{minipage}

\subsection{HDL Width Adapters Not Required}
% AV-1230 et al
One of the advantages of the new \textit{Scalable Data Plane} is the Framework's automatic insertion of ``width adapters'' whenever needed between Workers in an Assembly. This means the user can remove any \path{wsi_16_to_32}, \path{wsi_32_to_16}, or \path{wsi_width_adapter} Components that are instantiated in their Assemblies or Applications. It is harmless to leave them in existing designs, but future Applications should not instantiate them.

\subsection{Platform Name Changes}
% AV-2270
\label{sec:11_platform_names}
To allow for more hardware and software separation in the future, there is now more distinction used in platform naming. Previously, the keyword ``zed'' was used to describe both software (the Xilinx-based Linux kernel) and hardware (the ZedBoard). This ambiguity led to confusion for some users and implied a nonexistent reliance on the ZedBoard. Starting with OpenCPI 1.1, the software platform for most Zynq-based hardware is labeled ``\verb+xilinx13_3+'', analogous to ``\verb+centos7+''. The ``13\_3'' is shorthand for Xilinx's Linux release from the Third Quarter (Q3) of 2013. This means that previous code that used an \texttt{OCPI\_TARGET\_PLATFORM} of \texttt{zed} must now be changed to \texttt{xilinx13\_3}.

\subsection{RCC Cross-compilation No Longer Uses \texttt{OCPI\_CROSS\_HOST}}
% AV-816, AV-1998, AV-2143
Previous OpenCPI releases used \texttt{OCPI\_CROSS\_HOST} to define RCC cross-compilation. This required the usage of less-than-memorable values such as \texttt{arm-xilinx-linux-gnueabi}. The new manner is to use \texttt{OCPI\_TARGET\_PLATFORM}, \texttt{RccPlatforms}, or \texttt{RccHdlPlatforms}, which allow more intuitive and consistent values (See Section~\ref{sec:11_platform_names}). For example, the example above could be replaced with ``\texttt{OCPI\_TARGET\_PLATFORM=xilinx13\_3}'', ``\texttt{RccPlatforms=xilinx13\_3}'', or ``\texttt{RccHdlPlatforms=zed}''.\\

The \texttt{RccPlatforms} and \texttt{RccHdlPlatforms} variables allow the targeting of multiple platforms with a single \verb+make+ call.
% AV-2363
While either format can be used for Workers, ACI Applications can only be built for a single target platform using the \texttt{OCPI\_TARGET\_PLATFORM} variable.

\subsection{Updating a 1.0.x Unit Test for the 1.1 Framework}
% AV-1869
Some unit tests for Components were released with the 1.0.x version of \texttt{ocpiassets} that relied upon simulator availability or certain platform names reported by \texttt{ocpirun} (see Sections~\ref{sec:11_simulators} and \ref{sec:11_platform_names}). If any users have developed their own unit tests based on these, some updates may be required for them to work using the new release.\\

\begin{minipage}{\linewidth}
All of the provided unit tests have been updated to work with the new release and can be used for reference. If the previous unit test is using \texttt{ocpirun}, the \texttt{Makefile} needs to be updated to add the following to any lines that are forming the execution string:\\

\forceindent\code{-P \$@=\$P}\\

This is forcing the platform of your unit test to be set explicitly with \texttt{ocpirun}'s \texttt{-P} option. \\
\end{minipage}

If the unit test is using an ACI Application to run the unit test, the platform needs to be set similarly within the C++ source. The Platform will be passed from the \texttt{Makefile} to the ACI Application as a command-line argument by adding \code{\$P} to the end of any execution strings. The source code needs to be updated to use this new argument by adding the following to the C++ application, while changing ``\texttt{XXX}'' to your Worker's name and ``\texttt{2}'' to the correct argument number based on your current inputs:\\
\begin{minipage}{\linewidth}
\lstset{language=C++,
  basicstyle=\color{Blue}\ttfamily, % Blue (real blue) not blue (AV header blue)
  stringstyle=\color{Green},
}
\begin{lstlisting}[language=c++]
  std::string pf("XXX=");
  pf += argv[2];
  OA::PValue params[] = {
  ...
  OA::PVString("platform", pf.c_str()),
  ...
  OA::PVEnd};
  ...
  OA::Application app(appNameXml, params);
\end{lstlisting}
\end{minipage}
~\\
This patch is adding the platform that is passed in (via \texttt{argv[2]}) to the \texttt{params} array that is used to constrain the application's search space.\\

The user could do a full conversion to the new testing framework released with 1.1, but this is expected to be more work.

\subsection{Prerequisite RPM Changes}
\label{sec:11_prereq}
% AV-1117
The Open Source \href{http://tukaani.org/xz/}{XZ Utils} has replaced the LZMA Utils. This has caused the ANGRYVIPER-provided RPM to change names. Additionally, new RPMs are now provided for other prerequisite packages; consult the \textit{Installation Guide} for a list. An upgrade to the new RPMs \textit{should} cause previous versions to be removed, but the recommended procedure is to uninstall all 1.0.x RPMs before installing 1.1.\\

% AV-1788
For the first time, OpenCPI is providing a pre-packaged third-party library that is not directly required by the Framework: \href{http://liquidsdr.org/}{liquid-dsp}. This is provided to assist end users in the creation of DSP-heavy RCC Workers that execute on all currently-supported platforms without requiring any additional configuration for cross-compilation. It is treated like any other prerequisite library; usage information can be found in the \textit{OpenCPI RCC Development Guide}.

\subsection{Deprecated RCC controlOperations}
% AV-1711, AV-1674
The RCC \texttt{controlOperations} \texttt{afterConfigure} and \texttt{beforeQuery} have been deprecated and removed from the IDE. They were never called by the Framework and the C++ interface provides the finer-granularity \texttt{XXX\_read()} and \texttt{XXX\_written()} notification methods.

\subsection{64-Bit Build Host Issues (``Value too large for defined data type'')}
% AV-1838
Some 32-bit cross-compilers exhibit somewhat-rare problems on 64-bit host machines using file systems that allow 64-bit inodes, \textit{e.g.} XFS. A new RPM, \path{ocpi-rereq-build_support-inode64}, provides a workaround. Additional information can be found in the ANGRYVIPER-provided Picoflexor T6A documentation.

\section{Major Known Deficiencies}
This is a list of major known deficiencies at the release of 1.1 that were not previously documented in Section~\ref{sec:101}. This is \textit{not} an exhaustive list.

\subsection{Maximum Message Length in PCI-Based Platforms}
% AV-1392, AV-2105
\label{bug:1392}
PCI-based platforms, \textit{e.g.} ML605 and ALST4, are limited to a 32KB buffer. By default, that buffer is split into two, resulting in two 16KB buffers. The maximum message length, in bytes, is then 16KB-16\footnote{16 bytes required for metadata}. RCC Workers will see any data beyond the limit as zero-filled.

\subsection{MAC Address on ZedBoard}
% AV-2400, AV-2403
\label{bug:2400}
The currently used Linux release (``\texttt{xilinx13\_3}'') cannot properly set the MAC address on the ZedBoard. This should only affect users who have \textit{more than one ZedBoard} on a single network. Consult the \textit{ZedBoard Getting Started Guide} for a workaround.

\subsection{Platform Development Guide}
% AV-1585
\label{bug:1585}
While all documentation is constantly under improvement, the \textit{Platform Development Guide} in particular is currently undergoing major changes, in part due to the SDP improvements. If an end user intends to create a Board Support Package (BSP) for a new target platform, they should contact the ANGRYVIPER Team to ensure the latest Guide is used.

\newpage
\origsection{Release 1.0.1}
\label{sec:101}
These are ``Release Notes'' from Version 1.0.1 that are still relevant as of Version 1.1.
\section{OpenCPI HDL Assembly Filename Constraint}
\label{bug:1035}
% AV-1035
Due to a limitation with the ISE Simulator (isim), the filename of any HDL Assembly must be all lowercase letters. A capital letter anywhere in the filename will result in an error.

\section{32-bit Architecture File Size Limit}
\label{bug:693}
% AV-693
On some software platforms, there will be an error when writing files greater than 2\textsuperscript{31} bytes (about 2.2 GB), especially if using NFS. This includes the ARM 32-bit architecture on Zynq-based platforms.

\section{Eclipse Project Description File}
A necessary file known as the project description file (\verb+.project+) is generated when creating a Project in the ANGRYVIPER IDE. This file is required by Eclipse and is used to describe the project in its workspace. Removal of this file will cause an error.

\section{Refreshing the ANGRYVIPER IDE}
Whenever files are being created or removed via command-line for an Project, the Project within the IDE needs to be refreshed. Examples include executing \verb+make clean+, \verb+make tests+, \verb+make rcc+, etc. Many of the \verb+make+ commands will create or remove files in the Project, so it is important to refresh the Project within the IDE to reflect the changes.

\section{Non-default Xilinx Installation Locations}
OpenCPI assumes Xilinx's installation location is \verb+/opt/+. If the Xilinx tools were installed in another location, the cross compiling environment variable can not be inferred correctly. To resolve this issue, refer to the \path{/opt/opencpi/cdk/env/xilinx.sh.example} file and the \textit{Installation Guide}.

\section{Zero-Length Message Finite State Machines}
\label{sec:101_zlm}
Some workers make use of a finite state machine to monitor a zero-length message (\textit{ZLM}) from an upstream worker. This implementation was designed specifically with unit tests in mind so that simulations could be ended with an end-of-file (EOF) condition from the File Read Worker rather than waiting for a fixed amount of time. Simulation times vary across machines and Workers, so predicting how much time a Worker might need on various machines is not deterministic. In the future, the handling of zero-length message may change, but the current finite state machines for handling them are provided to complete the unit tests of the workers.
\end{appendices}
\end{document}
