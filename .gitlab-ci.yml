workflow:
  rules:
    - when: always

trigger-children:
  stage: trigger-children
  trigger:
    include:
    - artifact: .gitlab-ci.yml
      job: generate-children
    strategy: depend
  variables:
    CI_ROOT_SOURCE: "$CI_PIPELINE_SOURCE"
    CI_ROOT_ID: "$CI_PIPELINE_ID"
generate-children:
  artifacts:
    paths:
    - .gitlab-ci.yml
  image: centos:7
  script:
  - yum install epel-release -y
  - yum install python36-PyYAML -y
  - .gitlab-ci/scripts/ci_yaml_generator.py
  stage: generate-children
  tags:
  - docker
stages:
- .pre
- generate-children
- trigger-children
- deploy
include: .gitlab-ci/yaml-parent/verify-pipeline.yml