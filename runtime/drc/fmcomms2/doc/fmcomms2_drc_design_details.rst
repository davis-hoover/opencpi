.. DRC FMCOMMS2 Documentation:

.. This file is protected by Copyright. Please refer to the COPYRIGHT file
   distributed with this source distribution.

   This file is part of OpenCPI <http://www.opencpi.org>

   OpenCPI is free software: you can redistribute it and/or modify it under the
   terms of the GNU Lesser General Public License as published by the Free
   Software Foundation, either version 3 of the License, or (at your option) any
   later version.

   OpenCPI is distributed in the hope that it will be useful, but WITHOUT ANY
   WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR
   A PARTICULAR PURPOSE. See the GNU Lesser General Public License for
   more details.

   You should have received a copy of the GNU Lesser General Public License
   along with this program. If not, see <http://www.gnu.org/licenses/>.

.. Company:     Geon Technologies, LLC
   Author:      Joel Palmer
   Copyright:   (c) 2018 Geon Technologies, LLC. All rights reserved.
                Dissemination of this information or reproduction of this
                material is strictly prohibited unless prior written
                permission is obtained from Geon Technologies, LLC

.. _DRC_FMCOMMS2_Documentation:

DRC FMCOMMS2 Documentation
==========================

FMCOMMS2 DRC Mapping
--------------------

+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| DRC config              | Data   | Constraint Satisfaction      | No-OS API call                    | Constrained                             |
|                         | Stream | Problem Variable             |                                   | Range(s) [1]                            |
|                         | ID     |                              |                                   |                                         |
+=========================+========+==============================+===================================+=========================================+
| **N/A**                 | N/A    | ad9361_rx_rfpll_lo_freq      | N/A                               | [70,6000]                               |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_tx_rfpll_lo_freq      | N/A                               | [70,6000] [2]                           |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_rx_rf_bandwidth_meghz | N/A                               | [0.2,56]                                |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_tx_rf_bandwidth_meghz | N/A                               | [1.25,40]                               |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_rx_sampl_freq_meghz   | N/A                               | [2.083334,61.44] [3]                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_rx_sampl_freq_meghz   | N/A                               | [2.083334,61.44] [3]                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_dir_rx1               | N/A                               | 0 (rx)                                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_dir_rx2               | N/A                               | 0 (rx)                                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_dir_tx1               | N/A                               | 1 (tx)                                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_dir_tx2               | N/A                               | 1 (tx)                                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fc_meghz_rx1          | ad9361_set_rx_lo_freq()           | ad9361_rx_rfpll_lo_freq_meghz           |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fc_meghz_rx2          | ad9361_set_rx_lo_freq()           | ad9361_rx_rfpll_lo_freq_meghz           |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fc_meghz_tx1          | ad9361_set_tx_lo_freq()           | ad9361_tx_rfpll_lo_freq_meghz           |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fc_meghz_tx2          | ad9361_set_tx_lo_freq()           | ad9361_tx_rfpll_lo_freq_meghz           |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_bw_meghz_rx1          | ad9361_set_rx_rf_bandwidth()      | ad9361_rx_rf_bandwidth_meghz            |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_bw_meghz_rx2          | ad9361_set_rx_rf_bandwidth()      | ad9361_rx_rf_bandwidth_meghz            |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_bw_meghz_tx1          | ad9361_set_tx_rf_bandwidth()      | ad9361_tx_rf_bandwidth_meghz            |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_bw_meghz_tx2          | ad9361_set_tx_rf_bandwidth()      | ad9361_tx_rf_bandwidth_meghz            |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fs_megsps_rx1         | ad9361_set_rx_sampling_freq()     | ad9361_rx_sampl_freq_meghz              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fs_megsps_rx2         | ad9361_set_rx_sampling_freq()     | ad9361_rx_sampl_freq_meghz              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fs_megsps_tx1         | ad9361_set_tx_sampling_freq()     | ad9361_tx_sampl_freq_meghz              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_fs_megsps_tx2         | ad9361_set_tx_sampling_freq()     | ad9361_tx_sampl_freq_meghz              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_samps_comp_rx1        | N/A                               | 1                                       |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_samps_comp_rx2        | N/A                               | 1                                       |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_samps_comp_tx1        | N/A                               | 1                                       |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_samps_comp_tx2        | N/A                               | 1                                       |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_mode_rx1         | ad9361_set_rx_gain_control_mode() | [0..1] (agc..manual)                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_mode_rx2         | ad9361_set_rx_gain_control_mode() | [0..1] (agc..manual)                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_mode_tx1         | N/A                               | 1 (manual)                              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_mode_tx2         | N/A                               | 1 (manual)                              |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_db_rx1           | ad9361_set_rx_rf_gain()           | [-1,73] if 0<=Rx_RFPLL_LO_freq<=1300,   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | [-3,71] if 1300<Rx_RFPLL_LO_freq<=4000, |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | [-10,62] otherwise [4]                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_db_rx2           | ad9361_set_rx_rf_gain()           | [-1,73] if 0<=Rx_RFPLL_LO_freq<=1300,   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | [-3,71] if 1300<Rx_RFPLL_LO_freq<=4000, |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | [-10,62] otherwise [4]                  |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_db_tx1           | ad9361_set_tx_rf_gain()           | [-89.75,0] [5]                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | ad9361_gain_db_tx2           | ad9361_set_tx_rf_gain()           | [-89.75,0] [5]                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        | fmcomms2_fc_baluns_meghz     | N/A                               | [2400,2500] [6]                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **direction**           | rx1a   | fmcomms2_dir_rx1a            | N/A                               | ad9361_dir_rx1                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_dir_rx2a            |                                   | ad9361_dir_rx2                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_dir_tx1a            |                                   | ad9361_dir_tx1                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_dir_tx2a            |                                   | ad9361_dir_tx2                          |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **tuning_freq_MHz**     | rx1a   | fmcomms2_fc_meghz_rx1a       | N/A                               | ad9361_fc_meghz_rx1 intersected with    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | fmcomms2_fc_baluns_meghz                |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_fc_meghz_rx2a       |                                   | ad9361_fc_meghz_rx2 intersected with    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | fmcomms2_fc_baluns_meghz                |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_fc_meghz_tx1a       |                                   | ad9361_fc_meghz_tx1 intersectedwith     |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | fmcomms2_fc_baluns_meghz                |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_fc_meghz_tx2a       |                                   | ad9361_fc_meghz_tx2 intersected with    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   | fmcomms2_fc_baluns_meghz                |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **bandwidth_3dB_MHz**   | rx1a   | fmcomms2_bw_meghz_rx1a       | N/A                               | ad9361_bw_meghz_rx1                     |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_bw_meghz_rx2a       |                                   | ad9361_bw_meghz_rx2                     |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_bw_meghz_tx1a       |                                   | ad9361_bw_meghz_tx1                     |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_bw_meghz_tx2a       |                                   | ad9361_bw_meghz_tx2                     |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **sampling_rate_Msps**  | rx1a   | fmcomms2_fs_megsps_rx1a      | N/A                               | ad9361_fs_megsps_rx1                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_fs_megsps_rx2a      |                                   | ad9361_fs_megsps_rx2                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_fs_megsps_tx1a      |                                   | ad9361_fs_megsps_tx1                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_fs_megsps_tx2a      |                                   | ad9361_fs_megsps_tx2                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **samples_are_complex** | rx1a   | fmcomms2_samps_comp_rx1a     | N/A                               | ad9361_samps_comp_rx1                   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_samps_comp_rx2a     |                                   | ad9361_samps_comp_rx2                   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_samps_comp_tx1a     |                                   | ad9361_samps_comp_tx1                   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_samps_comp_tx2a     |                                   | ad9361_samps_comp_tx2                   |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **gain_mode**           | rx1a   | fmcomms2_gain_mode_rx1a      | N/A                               | ad9361_gain_mode_rx1                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_gain_mode_rx2a      |                                   | ad9361_gain_mode_rx2                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_gain_mode_tx1a      |                                   | ad9361_gain_mode_tx1                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_gain_mode_tx2a      |                                   | ad9361_gain_mode_tx2                    |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
| **gain_dB**             | rx1a   | fmcomms2_gain_db_rx1a        | N/A                               | ad9361_gain_db_rx1                      |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         |        |                              |                                   |                                         |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | rx2a   | fmcomms2_gain_db_rx2a        |                                   | ad9361_gain_db_rx2                      |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx1a   | fmcomms2_gain_db_tx1a        |                                   | ad9361_gain_db_tx1                      |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+
|                         | tx2a   | fmcomms2_gain_db_tx2a        |                                   | ad9361_gain_db_tx2                      |
+-------------------------+--------+------------------------------+-----------------------------------+-----------------------------------------+

References:

   #. Unless noted, all values are from datasheet https://www.analog.com/media/en/technical-documentation/data-sheets/ad9361.pdf

   #. https://github.com/analogdevicesinc/no-OS/blob/2018_R2/ad9361/sw/ad9361.c#L929

   #. OpenCPI/DRC usage of No-OS restricts sampling rates to >= 2.083334 Msps. Lower values have
      been observed to intermittently fail to be set on Zed/FMCOMMS2/3

   #. Assumes No-OS 2018_R2 release (earlier releases known to have different values, see
      https://github.com/analogdevicesinc/no-OS/blob/2018_R2/ad9361/sw/ad9361.c lines 484,601)

   #. https://github.com/analogdevicesinc/no-OS/blob/2018_R2/ad9361/sw/ad9361.c#L1610

   #. https://wiki.analog.com/resources/eval/user-guides/ad-fmcomms2-ebz
